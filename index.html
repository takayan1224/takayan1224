<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- ズーム禁止 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>タップバトル with ミッフィーアニメ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>タップバトル</h1>

  <!-- ミッフィー画像 -->
  <div id="miffy-container">
    <img id="miffy" src="miffy.png" alt="ミッフィー">
  </div>

  <div id="timer">10</div>
  <div id="score"><span class="highlight">0</span> iya!</div>
  <button id="tapButton">タップ！</button>
  <button id="startButton">スタート</button>

  <script>
    // ■ Google フォーム送信用設定
    const FORM_URL    = 'https://docs.google.com/forms/u/0/d/e/YOUR_FORM_ID/formResponse';
    const NAME_FIELD  = 'entry.1234567890';  // 実際の entry.xxxxxx に置き換えてください
    const SCORE_FIELD = 'entry.0987654321';  // 実際の entry.xxxxxx に置き換えてください

    let timeLeft, score, timerInterval;
    const timerEl     = document.getElementById('timer');
    const scoreEl     = document.getElementById('score');
    const tapButton   = document.getElementById('tapButton');
    const startButton = document.getElementById('startButton');
    const miffyEl     = document.getElementById('miffy');

    startButton.addEventListener('click', () => {
      // 初期化
      timeLeft = 10;
      score    = 0;
      timerEl.textContent = timeLeft;
      scoreEl.innerHTML   = `<span class="highlight">${score}</span> iya!`;
      startButton.style.display = 'none';
      tapButton.style.display   = 'inline-block';
      tapButton.disabled        = false;

      // タイマー開始
      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        if (timeLeft <= 0) endGame();
      }, 1000);
    });

    tapButton.addEventListener('click', () => {
      if (timeLeft > 0) {
        // スコア更新
        score++;
        scoreEl.innerHTML = `<span class="highlight">${score}</span> iya!`;

        // ミッフィー跳ねるアニメ
        miffyEl.classList.remove('bounce');
        void miffyEl.offsetWidth; // 再フローを強制
        miffyEl.classList.add('bounce');
      }
    });

    function endGame() {
      clearInterval(timerInterval);
      tapButton.disabled = true;
      tapButton.style.display = 'none';

      const playerName = prompt('あなたの名前を入力してください');
      if (playerName) {
        submitScoreToGoogle(playerName, score);
        alert('スコアを送信しました！');
      } else {
        alert('名前が入力されなかったためスコアは送信されませんでした。');
      }

      startButton.style.display = 'inline-block';
    }

    function submitScoreToGoogle(name, score) {
      const data = new URLSearchParams();
      data.append(NAME_FIELD, name);
      data.append(SCORE_FIELD, score);
      fetch(FORM_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: data
      });
    }
  </script>

</body>
</html>
