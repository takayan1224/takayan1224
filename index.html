<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- ズーム禁止 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>タップバトル with Google フォーム送信</title>
  <!-- 外部CSSを読み込む -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h1>掃除いやいやタップゲーム</h1>
  <div id="timer">10</div>
  <div id="score"><span class="highlight">0</span> iya!</div>
  <button id="tapButton">いや！！</button>
  <button id="startButton">スタート</button>

  <script>
    // ■ Google フォーム送信用設定
    const FORM_URL    = 'https://docs.google.com/forms/u/0/d/e/1FAIpQLScVLXwle4IvaDxS2NWVx9I8gMneL-eSTYRqYYWMtqXD4AFzgA/formResponse';
    const NAME_FIELD  = 'entry.1667011312';
    const SCORE_FIELD = 'entry.1114664237';

    let timeLeft, score, timerInterval;
    const timerEl     = document.getElementById('timer');
    const scoreEl     = document.getElementById('score');
    const tapButton   = document.getElementById('tapButton');
    const startButton = document.getElementById('startButton');

    startButton.addEventListener('click', () => {
      timeLeft = 20;
      score    = 0;
      timerEl.textContent = timeLeft;
      scoreEl.innerHTML = `<span class="highlight">${score}</span> iya!`;
      startButton.style.display = 'none';
      tapButton.style.display   = 'inline-block';
      tapButton.disabled        = false;

      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        if (timeLeft <= 0) endGame();
      }, 1000);
    });

    tapButton.addEventListener('click', () => {
      if (timeLeft > 0) {
        score++;
        scoreEl.innerHTML = `<span class="highlight">${score}</span> iya!`;
      }
    });

    function endGame() {
      clearInterval(timerInterval);
      tapButton.disabled = true;
      tapButton.style.display = 'none';
      const playerName = prompt('あなたの名前を入力してください');
      if (playerName) {
        submitScoreToGoogle(playerName, score);
        alert('スコアを送信しました！');
      } else {
        alert('名前が入力されなかったためスコアは送信されませんでした。');
      }
      startButton.style.display = 'inline-block';
    }

    function submitScoreToGoogle(name, score) {
      const data = new URLSearchParams();
      data.append(NAME_FIELD, name);
      data.append(SCORE_FIELD, score);
      fetch(FORM_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: data
      });
    }
  </script>

</body>
</html>
